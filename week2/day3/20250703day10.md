# 10일차(2025.07.03)
## 개요
- `groupby()`, `agg()` 를 활용해 데이터 집계
## 활동 내용
### 진도
```python
import pandas as pd

data = {
    '이름': ['지훈', '민서', '서준', '예은', '도윤', '수아', '현우', '하은', '지민', '시우'],
    '성별': ['남', '여', '남', '여', '남', '여', '남', '여', '여', '남'],
    '반': ['A', 'A', 'B', 'B', 'C', 'C', 'A', 'B', 'C', 'A'],
    '전공': ['생명과학', '생명과학', '화학', '화학', '생명과학', '화학', '화학', '생명과학', '화학', '생명과학'],
    '중간고사': [95, 68, 91, 45, 100, 55, 70, 83, 35, 88],
    '기말고사': [40, 97, 60, 95, 35, 98, 65, 62, 95, 72],
    '과제': [55, 100, 80, 92, 85, 90, 60, 77, 100, 65],
}

df = pd.DataFrame(data)
df['총합'] = df['중간고사'] * 0.4 + df['기말고사'] * 0.4 + df['과제'] * 0.2
df=df.set_index('이름')
df
```
1. 반 별 총합의 평균
```python
df.groupby('반')['총합'].mean()

#결과
반
A    73.500000
B    74.733333
C    74.066667
Name: 총합, dtype: float64
```
2. 성별과 전공에 따른 총합 평균
```python
df.groupby(['성별', '전공'])['총합'].mean()

#결과
성별  전공
남   생명과학    71.0
    화학      71.2
여   생명과학    79.7
    화학      75.2
Name: 총합, dtype: float64
```

3. 전공별 1등 추출
```python
df.loc[df.groupby('전공')['총합'].idxmax()]

#결과
   성별  반    전공  중간고사  기말고사   과제    총합
이름
민서  여  A  생명과학    68    97  100  86.0
수아  여  C    화학    55    98   90  79.2
```
4. aggregation 연습
- 성별에 따라 중간고사, 기말고사의 평균, 최대, 최소를 구하고 총합의 평균과 표준편차 출력
```python
df.groupby('성별').agg({
    '중간고사' : ['mean','max','min'],
    '기말고사' : ['mean','max','min'],
    '총합' : ['mean','std']
})

#결과
    중간고사           기말고사             총합
    mean  max min  mean max min   mean       std
성별
남   88.8  100  70  54.4  72  35  71.08  5.615336
여   57.2   83  35  89.4  98  62  77.00  5.713143
```
### 예제 풀이
```python
import pandas as pd

data = {
    '지점': ['강남', '강남', '홍대', '홍대', '강남', '신촌', '신촌', '강남', '홍대', '신촌'],
    '카테고리': ['음료', '과자', '음료', '과자', '담배', '과자', '음료', '과자', '담배', '담배'],
    '상품명': ['콜라', '새우깡', '사이다', '포카칩', '에쎄', '초코파이', '이프로', '칸쵸', '말보로', '보헴'],
    '판매수량': [120, 80, 60, 90, 200, 55, 100, 40, 180, 150],
    '단가': [1500, 1200, 1500, 1300, 4500, 1000, 1600, 1100, 5000, 4700]
}
df = pd.DataFrame(data)
df['매출'] = df['판매수량'] * df['단가']
df
```
1. 지점별 총매출, 평균매출
```python
df.groupby('지점')['매출'].agg(['sum','mean'])

#결과
        sum           mean
지점
강남  1220000  305000.000000
신촌   920000  306666.666667
홍대  1107000  369000.000000
```
2. 카테고리별 평균 판매 수량, 표준편차
```python
df.groupby('카테고리')['판매수량'].agg(['mean', 'std'])

#결과
            mean        std
카테고리
과자     66.250000  22.867371
담배    176.666667  25.166115
음료     93.333333  30.550505
```

3. 지점별 가장 많이 팔린 상품
```python
df.loc[df.groupby('지점')['판매수량'].idxmax()]

#결과
   지점 카테고리  상품명  판매수량    단가      매출
4  강남   담배   에쎄   200  4500  900000
9  신촌   담배   보헴   150  4700  705000
8  홍대   담배  말보로   180  5000  900000
```

4. 지점+카테고리 조합으로 평균 매출
```python
df.groupby(['지점','카테고리'])['매출'].mean()

#결과
지점  카테고리
강남  과자       70000.0
    담배      900000.0
    음료      180000.0
신촌  과자       55000.0
    담배      705000.0
    음료      160000.0
홍대  과자      117000.0
    담배      900000.0
    음료       90000.0
Name: 매출, dtype: float64
```

5. 전체 상품 중 판매량 Top 3
```python
df.sort_values(by='판매수량', ascending=False).head(3)

#결과
   지점 카테고리  상품명  판매수량    단가      매출
4  강남   담배   에쎄   200  4500  900000
8  홍대   담배  말보로   180  5000  900000
9  신촌   담배   보헴   150  4700  705000
```

6. 카테고리별 총매출이 가장 높은 지점
```python
df.groupby(['카테고리','지점'])['매출'].sum().groupby(level=0).idxmax()

#결과
카테고리
과자    (과자, 강남)
담배    (담배, 강남)
음료    (음료, 강남)
Name: 매출, dtype: object
```

7. 카테고리별 가장 인기 상품(판매수량 기준)
```python
df.loc[df.groupby('카테고리')['판매수량'].idxmax()]

#결과
   지점 카테고리  상품명  판매수량    단가      매출
3  홍대   과자  포카칩    90  1300  117000
4  강남   담배   에쎄   200  4500  900000
0  강남   음료   콜라   120  1500  180000
```